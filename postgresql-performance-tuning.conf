# PostgreSQL Configuration Recommendations for ERP System (500 Concurrent Users)
# Add these settings to your postgresql.conf file

# Connection Settings
max_connections = 300                    # Allow up to 300 connections (leaving room for maintenance)
shared_buffers = 256MB                   # 25% of available RAM (adjust based on your server)
effective_cache_size = 1GB              # 75% of available RAM (adjust based on your server)

# Memory Settings
work_mem = 4MB                          # Memory for sorting and hash operations
maintenance_work_mem = 64MB             # Memory for maintenance operations
temp_buffers = 8MB                      # Temporary buffer size

# WAL (Write-Ahead Logging) Settings
wal_buffers = 16MB                      # WAL buffer size
checkpoint_completion_target = 0.9       # Spread checkpoints over 90% of checkpoint interval
max_wal_size = 2GB                      # Maximum WAL size before checkpoint
min_wal_size = 80MB                     # Minimum WAL size

# Query Planning
random_page_cost = 1.1                  # Cost of random page access (SSD optimized)
effective_io_concurrency = 200          # Concurrent I/O operations (SSD optimized)
seq_page_cost = 1.0                     # Cost of sequential page access

# Logging Settings (for monitoring)
log_min_duration_statement = 1000       # Log queries taking more than 1 second
log_connections = on                     # Log connection attempts
log_disconnections = on                  # Log disconnections
log_lock_waits = on                     # Log lock waits
log_statement = 'ddl'                   # Log DDL statements

# Connection Pooling Support
tcp_keepalives_idle = 600               # TCP keepalive idle time
tcp_keepalives_interval = 30            # TCP keepalive interval
tcp_keepalives_count = 9                # TCP keepalive retry count

# Performance Monitoring
track_activities = on                    # Track running queries
track_counts = on                       # Track table statistics
track_io_timing = on                    # Track I/O timing
track_functions = pl                    # Track function calls

# Autovacuum Settings (Important for ERP systems)
autovacuum = on                         # Enable autovacuum
autovacuum_max_workers = 3              # Number of autovacuum workers
autovacuum_naptime = 1min               # Sleep time between autovacuum runs

# For better ERP performance
default_statistics_target = 100         # Statistics sampling for query planning
constraint_exclusion = partition        # Enable constraint exclusion for partitioning

# Additional settings for high-concurrency ERP systems
max_locks_per_transaction = 64          # Maximum locks per transaction
max_pred_locks_per_transaction = 64     # Maximum predicate locks per transaction

# Note: Adjust memory settings based on your server's available RAM
# These settings assume at least 4GB RAM dedicated to PostgreSQL
